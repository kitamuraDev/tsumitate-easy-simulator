<app-head-content [title]="'シュミレーション'" [hasDescription]="false" />
<section class="flex flex-col gap-8">
  <form [formGroup]="inputs" class="flex flex-col gap-6 p-6">
    <div class="space-y-2.5">
      <!-- 初期投資額 -->
      <div data-testid="slider-initial-asset">
        <div class="flex items-center justify-between">
          <app-label-text [id]="'initialAsset'" [isRequired]="true">初期投資額</app-label-text>
          <app-display-range-input-value>{{ inputs.value.initialAsset }}</app-display-range-input-value>
        </div>
        <input
          type="range"
          id="initialAsset"
          formControlName="initialAsset"
          min="0"
          max="1800"
          step="5"
          required
          (input)="updateFormValidState()"
          class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
        />
      </div>

      <!-- 年率 -->
      <div data-testid="slider-rate">
        <div class="flex items-center justify-between">
          <app-label-text [id]="'rate'" [isRequired]="true">年率</app-label-text>
          <app-display-range-input-value>{{ inputs.value.rate }}</app-display-range-input-value>
        </div>
        <input
          type="range"
          id="rate"
          formControlName="rate"
          min="0"
          max="15"
          required
          (input)="updateFormValidState()"
          class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
        />
      </div>

      <!-- 毎月積立額 -->
      <div data-testid="slider-amount-required">
        <div class="flex items-center justify-between">
          <app-label-text [id]="'amountRequired'" [isRequired]="true">毎月積立額</app-label-text>
          <app-display-range-input-value>{{ inputs.value.amountRequired }}</app-display-range-input-value>
        </div>
        <input
          type="range"
          id="amountRequired"
          formControlName="amountRequired"
          min="1"
          max="30"
          required
          (input)="updateFormValidState()"
          class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
        />
      </div>

      <!-- 積立期間 -->
      <div data-testid="slider-year-required">
        <div class="flex items-center justify-between">
          <app-label-text [id]="'yearRequired'" [isRequired]="true">積立期間</app-label-text>
          <app-display-range-input-value>{{ inputs.value.yearRequired }}</app-display-range-input-value>
        </div>
        <input
          type="range"
          id="yearRequired"
          formControlName="yearRequired"
          min="1"
          max="15"
          required
          (input)="updateFormValidState()"
          class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
        />
      </div>
    </div>

    @defer (when amountChangeSetting().isAmountChangeEnabled) {
      @if (amountChangeSetting().isAmountChangeEnabled) {
        <div data-testid="any-inputs-container" class="space-y-2.5">
          <!-- 任意入力 1 -->
          @if (['1', '2', '3'].includes(amountChangeSetting().selectedAmountChangeCount)) {
            <div data-testid="slider-amount-any-1">
              <div class="flex items-center justify-between">
                <app-label-text [id]="'amountAny1'" [isRequired]="false">毎月積立額</app-label-text>
                <app-display-range-input-value>{{ inputs.value.amountAny1 }}</app-display-range-input-value>
              </div>
              <input
                type="range"
                id="amountAny1"
                formControlName="amountAny1"
                min="0"
                max="30"
                (input)="updateFormValidState()"
                class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
              />
            </div>
            <div data-testid="slider-year-any-1">
              <div class="flex items-center justify-between">
                <app-label-text [id]="'yearAny1'" [isRequired]="false">積立期間</app-label-text>
                <app-display-range-input-value>{{ inputs.value.yearAny1 }}</app-display-range-input-value>
              </div>
              <input
                type="range"
                id="yearAny1"
                formControlName="yearAny1"
                min="0"
                max="15"
                (input)="updateFormValidState()"
                class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
              />
            </div>
          }
          <!-- 任意入力 2 -->
          @if (['2', '3'].includes(amountChangeSetting().selectedAmountChangeCount)) {
            <div data-testid="slider-amount-any-2">
              <div class="flex items-center justify-between">
                <app-label-text [id]="'amountAny2'" [isRequired]="false">毎月積立額</app-label-text>
                <app-display-range-input-value>{{ inputs.value.amountAny2 }}</app-display-range-input-value>
              </div>
              <input
                type="range"
                id="amountAny2"
                formControlName="amountAny2"
                min="0"
                max="30"
                (input)="updateFormValidState()"
                class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
              />
            </div>
            <div data-testid="slider-year-any-2">
              <div class="flex items-center justify-between">
                <app-label-text [id]="'yearAny2'" [isRequired]="false">積立期間</app-label-text>
                <app-display-range-input-value>{{ inputs.value.yearAny2 }}</app-display-range-input-value>
              </div>
              <input
                type="range"
                id="yearAny2"
                formControlName="yearAny2"
                min="0"
                max="15"
                (input)="updateFormValidState()"
                class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
              />
            </div>
          }
          <!-- 任意入力 3 -->
          @if (['3'].includes(amountChangeSetting().selectedAmountChangeCount)) {
            <div data-testid="slider-amount-any-3">
              <div class="flex items-center justify-between">
                <app-label-text [id]="'amountAny3'" [isRequired]="false">毎月積立額</app-label-text>
                <app-display-range-input-value>{{ inputs.value.amountAny3 }}</app-display-range-input-value>
              </div>
              <input
                type="range"
                id="amountAny3"
                formControlName="amountAny3"
                min="0"
                max="30"
                (input)="updateFormValidState()"
                class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
              />
            </div>
            <div data-testid="slider-year-any-3">
              <div class="flex items-center justify-between">
                <app-label-text [id]="'yearAny3'" [isRequired]="false">積立期間</app-label-text>
                <app-display-range-input-value>{{ inputs.value.yearAny3 }}</app-display-range-input-value>
              </div>
              <input
                type="range"
                id="yearAny3"
                formControlName="yearAny3"
                min="0"
                max="15"
                (input)="updateFormValidState()"
                class="w-full h-1 bg-gray-200 rounded appearance-none cursor-pointer custom-range-thumb"
              />
            </div>
          }
        </div>
      }
    }
  </form>
</section>

<app-base-button [disabled]="isAbnormalInput()" popovertarget="display-simulation-result" (clickEvent)="onCalculate()">
  計算
</app-base-button>

<app-display-simulation-result [tsumitateSimulationResult]="tsumitateSimulationResult()" />
